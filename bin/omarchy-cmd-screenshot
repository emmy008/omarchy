#!/bin/bash

[[ -f ~/.config/user-dirs.dirs ]] && source ~/.config/user-dirs.dirs
OUTPUT_DIR="${OMARCHY_SCREENSHOT_DIR:-${XDG_PICTURES_DIR:-$HOME/Pictures}}"

if [[ ! -d "$OUTPUT_DIR" ]]; then
  notify-send "Screenshot directory does not exist: $OUTPUT_DIR" -u critical -t 3000
  exit 1
fi

# Use grim and slurp for screenshots, then swappy for editing
# Note: swappy doesn't support all of satty's features
OUTPUT_FILE="$OUTPUT_DIR/screenshot-$(date +'%Y-%m-%d_%H-%M-%S').png"

if [ "${1:-region}" = "region" ]; then
  # Region screenshot
  grim -g "$(slurp)" - | swappy -f - -o "$OUTPUT_FILE"
else
  # Full screen screenshot
  grim - | swappy -f - -o "$OUTPUT_FILE"
fi

# Copy to clipboard after saving
if [ -f "$OUTPUT_FILE" ]; then
  wl-copy < "$OUTPUT_FILE"
  notify-send "Screenshot saved" "$OUTPUT_FILE" -t 2000
fi
